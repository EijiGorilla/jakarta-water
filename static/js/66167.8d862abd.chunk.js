"use strict";(self.webpackChunkjakarta_water=self.webpackChunkjakarta_water||[]).push([[66167],{114(e,t,a){a.d(t,{P:()=>u});var i=a(59422),n=a(62887),r=a(5095),s=a(40480),o=a(3986),l=a(93345);const c=1/65536;class u extends o.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,i.vt)()}dispose(){}drawMany(e,t){const a=e.styleLayer;this._drawIcons(e,a,t),this._drawText(e,a,t)}_drawIcons(e,t,a){const{context:i,displayLevel:o,painter:l,spriteMosaic:c,state:u,styleLayerUID:f,requestRender:d,allowDelayedRender:p}=e,g=t.iconMaterial,m=l.vectorTilesMaterialManager;let y,_=!1;for(const n of a)if(n.layerData.has(f)&&(y=n.layerData.get(f),y.iconPerPageElementsMap.size>0)){_=!0;break}if(!_)return;const M=t.getPaintValue("icon-translate",o),h=t.getPaintValue("icon-translate-anchor",o);let v=t.getLayoutValue("icon-rotation-alignment",o);2===v&&(v=0===t.getLayoutValue("symbol-placement",o)?1:0);const U=0===v,x=t.getLayoutValue("icon-keep-upright",o)&&U,P=y.isIconSDF,E=this._iconProgramOptions;E.sdf=P;const S=m.getMaterialProgram(i,g,E);if(p&&null!=d&&!S.compiled)return void d();i.useProgram(S),S.setUniformMatrix3fv("u_displayViewMat3",0===v?u.displayViewMat3:u.displayMat3),S.setUniformMatrix3fv("u_displayMat3",1===h?u.displayMat3:u.displayViewMat3),S.setUniform2fv("u_iconTranslation",M),S.setUniform1f("u_depth",t.z),S.setUniform1f("u_mapRotation",(0,s.wV)(u.rotation)),S.setUniform1f("u_keepUpright",x?1:0),S.setUniform1f("u_level",10*o),S.setUniform1i("u_texture",r.$U),S.setUniform1f("u_fadeDuration",n.zk/1e3),S.setUniform1i("u_isStencilPass",e.stencilSymbols?1:0);let w=-1;for(const n of a){if(!n.layerData.has(f))continue;if(n.key.level!==w&&(w=n.key.level,g.setDataUniforms(S,o,t,w,c)),y=n.layerData.get(f),0===y.iconPerPageElementsMap.size)continue;y.prepareForRendering(i),y.updateOpacityInfo();const a=y.iconVAO;if(null!=a){i.bindVAO(a),S.setUniformMatrix3fv("u_dvsMat3",n.transforms.displayViewScreenMat3),S.setUniform1f("u_time",(performance.now()-y.lastOpacityUpdate)/1e3);for(const[t,a]of y.iconPerPageElementsMap)this._renderIconRange(e,S,a,t,n)}}}_renderIconRange(e,t,a,i,n){const{context:s,spriteMosaic:o}=e;this._spritesTextureSize[0]=o.getWidth(i)/4,this._spritesTextureSize[1]=o.getHeight(i)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(s,9729,i,r.$U),this._setStencilState(e,n),s.drawElements(l.WR.TRIANGLES,a[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]),n.triangleCount+=a[1]/3}_drawText(e,t,a){const{context:o,displayLevel:l,glyphMosaic:u,painter:f,pixelRatio:d,spriteMosaic:p,state:g,styleLayerUID:m,requestRender:y,allowDelayedRender:_}=e,M=t.textMaterial,h=f.vectorTilesMaterialManager;let v,U=!1;for(const i of a)if(i.layerData.has(m)&&(v=i.layerData.get(m),v.glyphPerPageElementsMap.size>0)){U=!0;break}if(!U)return;const x=t.getPaintProperty("text-opacity");if(x&&!x.isDataDriven&&0===x.getValue(l))return;const P=t.getPaintProperty("text-color"),E=!P||P.isDataDriven||P.getValue(l)[3]>0,S=t.getPaintProperty("text-halo-width"),w=t.getPaintProperty("text-halo-color"),D=(!S||S.isDataDriven||S.getValue(l)>0)&&(!w||w.isDataDriven||w.getValue(l)[3]>0);if(!E&&!D)return;let R=t.getLayoutValue("text-rotation-alignment",l);2===R&&(R=0===t.getLayoutValue("symbol-placement",l)?1:0);const I=0===R,V=t.getLayoutValue("text-keep-upright",l)&&I,T=.8*3/d;this._glyphTextureSize||(this._glyphTextureSize=(0,i.fA)(u.width/4,u.height/4));const L=t.getPaintValue("text-translate",l),N=t.getPaintValue("text-translate-anchor",l),A=this._sdfProgramOptions,k=h.getMaterialProgram(o,M,A);if(_&&null!=y&&!k.compiled)return void y();o.useProgram(k),k.setUniformMatrix3fv("u_displayViewMat3",0===R?g.displayViewMat3:g.displayMat3),k.setUniformMatrix3fv("u_displayMat3",1===N?g.displayMat3:g.displayViewMat3),k.setUniform2fv("u_textTranslation",L),k.setUniform1f("u_depth",t.z+c),k.setUniform2fv("u_mosaicSize",this._glyphTextureSize),k.setUniform1f("u_mapRotation",(0,s.wV)(g.rotation)),k.setUniform1f("u_keepUpright",V?1:0),k.setUniform1f("u_level",10*l),k.setUniform1i("u_texture",r.mg),k.setUniform1f("u_antialiasingWidth",T),k.setUniform1f("u_fadeDuration",n.zk/1e3);let b=-1;for(const i of a){if(!i.layerData.has(m))continue;if(i.key.level!==b&&(b=i.key.level,M.setDataUniforms(k,l,t,b,p)),v=i.layerData.get(m),0===v.glyphPerPageElementsMap.size)continue;v.prepareForRendering(o),v.updateOpacityInfo();const a=v.textVAO;if(null==a)continue;o.bindVAO(a),k.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),this._setStencilState(e,i);const n=(performance.now()-v.lastOpacityUpdate)/1e3;k.setUniform1f("u_time",n),v.glyphPerPageElementsMap.forEach((e,t)=>{this._renderGlyphRange(o,e,t,u,k,D,E,i)})}}_renderGlyphRange(e,t,a,i,n,s,o,c){i.bind(e,9729,a,r.mg),s&&(n.setUniform1f("u_halo",1),e.drawElements(l.WR.TRIANGLES,t[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),c.triangleCount+=t[1]/3),o&&(n.setUniform1f("u_halo",0),e.drawElements(l.WR.TRIANGLES,t[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),c.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:a,is3D:i,stencilSymbols:n}=e;if(a.setStencilTestEnabled(!0),n)return a.setStencilWriteMask(255),void a.setStencilFunction(519,t.stencilRef,255);a.setStencilWriteMask(0),i?a.setStencilFunction(514,t.stencilRef,255):a.setStencilFunction(516,255,255)}}},3986(e,t,a){a.d(t,{A:()=>i});class i{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,a){}drawMany(e,t,a){for(const i of t)i.visible&&this.draw(e,i,a)}}},38134(e,t,a){a.d(t,{F:()=>d});var i=a(15941),n=a(30726),r=a(85827),s=a(28608),o=a(5095),l=a(3986),c=a(93345),u=a(36911),f=a(9243);class d extends l.A{constructor(){super(...arguments),this._color=(0,s.fA)(1,0,0,1),this._patternMatrix=(0,r.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao=(0,n.WD)(this._vao)}drawMany(e,t){const{context:a,painter:n,requestRender:r,allowDelayedRender:s}=e;this._loadWGLResources(e);const l=e.displayLevel,u=e.styleLayer,f=u.backgroundMaterial,d=n.vectorTilesMaterialManager,p=u.getPaintValue("background-color",l),g=u.getPaintValue("background-opacity",l),m=u.getPaintValue("background-pattern",l),y=void 0!==m,_=1|window.devicePixelRatio,M=e.spriteMosaic;let h,v;const U=_>o.C_?2:1,x=this._programOptions;x.pattern=y;const P=d.getMaterialProgram(a,f,x);if(!s||null==r||P.compiled){if(a.bindVAO(this._vao),a.useProgram(P),y){const e=M.getMosaicItemPosition(m,!0);if(null!=e){const{tl:t,br:i,page:n}=e;h=i[0]-t[0],v=i[1]-t[1];const r=M.getPageSize(n);null!=r&&(M.bind(a,9729,n,o.$U),P.setUniform4f("u_tlbr",t[0],t[1],i[0],i[1]),P.setUniform2fv("u_mosaicSize",r),P.setUniform1i("u_texture",o.$U))}P.setUniform1f("u_opacity",g)}else{const e=p[3]*g;this._color[0]=e*p[0],this._color[1]=e*p[1],this._color[2]=e*p[2],this._color[3]=e,P.setUniform4fv("u_color",this._color)}P.setUniform1f("u_depth",u.z||0);for(const e of t){if(P.setUniform1f("u_coord_range",e.rangeX),P.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),y){const t=Math.max(2**(Math.round(l)-e.key.level),1),a=U*e.width*t,n=a/(0,i.yR)(h),r=a/(0,i.yR)(v);this._patternMatrix[0]=n,this._patternMatrix[4]=r,P.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}a.setStencilFunction(514,0,255),a.drawArrays(c.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:a}=e,i=a.backgroundMaterial,n=new Int8Array([0,0,1,0,0,1,1,1]),r=new f.R(t,i.geometryLayout,n);this._vao=new u.Z(t,r)}}},40480(e,t,a){a.d(t,{p6:()=>o,wV:()=>s});Math.PI;const i=256/360,n=1/Math.LN2;function r(e,t){return(e%=t)>=0?e:e+t}function s(e){return r(e*i,256)}function o(e){return Math.log(e)*n}},43106(e,t,a){a.d(t,{p:()=>r});var i=a(3986),n=a(93345);class r extends i.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:a,displayLevel:i,requiredLevel:r,state:s,painter:o,spriteMosaic:l,styleLayerUID:c,requestRender:u,allowDelayedRender:f}=e;if(!t.some(e=>{var t,a;return null!==(t=null===(a=e.layerData.get(c))||void 0===a?void 0:a.circleIndexCount)&&void 0!==t&&t}))return;const d=e.styleLayer,p=d.circleMaterial,g=o.vectorTilesMaterialManager,m=d.getPaintValue("circle-translate",i),y=d.getPaintValue("circle-translate-anchor",i),_=this._programOptions,M=g.getMaterialProgram(a,p,_);if(f&&null!=u&&!M.compiled)return void u();a.useProgram(M),M.setUniformMatrix3fv("u_displayMat3",1===y?s.displayMat3:s.displayViewMat3),M.setUniform2fv("u_circleTranslation",m),M.setUniform1f("u_depth",d.z),M.setUniform1f("u_antialiasingWidth",1.2);let h=-1;for(const v of t){if(!v.layerData.has(c))continue;v.key.level!==h&&(h=v.key.level,p.setDataUniforms(M,i,d,h,l));const e=v.layerData.get(c);if(!e.circleIndexCount)continue;e.prepareForRendering(a);const t=e.vao;null!=t&&(a.bindVAO(t),M.setUniformMatrix3fv("u_dvsMat3",v.transforms.displayViewScreenMat3),r!==v.key.level?a.setStencilFunction(514,v.stencilRef,255):a.setStencilFunction(516,255,255),a.drawElements(n.WR.TRIANGLES,e.circleIndexCount,n.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),v.triangleCount+=e.circleIndexCount/3)}}}},51519(e,t,a){a.d(t,{I:()=>o});var i=a(5095),n=a(3986),r=a(93345);const s=1/65536;class o extends n.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:a,renderPass:i,spriteMosaic:n,styleLayerUID:r}=e;let s=!1;for(const M of t)if(M.layerData.has(r)){const e=M.layerData.get(r);if(e.fillIndexCount>0||e.outlineIndexCount>0){s=!0;break}}if(!s)return;const o=e.styleLayer,l=o.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let f;if(c&&!u){const e=l.getValue(a);f=n.getMosaicItemPosition(e,!0)}const d=!c&&o.getPaintValue("fill-antialias",a);let p=!0,g=1;if(!c){const e=o.getPaintProperty("fill-color"),t=o.getPaintProperty("fill-opacity");if((null===e||void 0===e||!e.isDataDriven)&&(null===t||void 0===t||!t.isDataDriven)){const e=o.getPaintValue("fill-color",a);g=o.getPaintValue("fill-opacity",a)*e[3],g>=1&&(p=!1)}}if(p&&"opaque"===i)return;const m=o.getPaintValue("fill-translate",a),y=o.getPaintValue("fill-translate-anchor",a);(p||"translucent"!==i)&&this._drawFill(e,r,o,t,m,y,c,f,u);const _=!o.hasDataDrivenOutlineColor&&o.outlineUsesFillColor&&g<1;d&&"opaque"!==i&&!_&&this._drawOutline(e,r,o,t,m,y)}_drawFill(e,t,a,n,o,l,c,u,f){if(c&&!f&&null==u)return;const{context:d,displayLevel:p,state:g,painter:m,pixelRatio:y,spriteMosaic:_,requestRender:M,allowDelayedRender:h}=e,v=a.fillMaterial,U=m.vectorTilesMaterialManager,x=y>i.C_?2:1,P=this._fillProgramOptions;P.pattern=c;const E=U.getMaterialProgram(d,v,P);if(h&&null!=M&&!E.compiled)return void M();if(d.useProgram(E),null!=u){const{page:e}=u,t=_.getPageSize(e);null!=t&&(_.bind(d,9729,e,i.$U),E.setUniform2fv("u_mosaicSize",t),E.setUniform1i("u_texture",i.$U))}E.setUniformMatrix3fv("u_displayMat3",1===l?g.displayMat3:g.displayViewMat3),E.setUniform2fv("u_fillTranslation",o),E.setUniform1f("u_depth",a.z+s);let S=-1;for(const s of n){if(!s.layerData.has(t))continue;s.key.level!==S&&(S=s.key.level,v.setDataUniforms(E,p,a,S,_));const e=s.layerData.get(t);if(!e.fillIndexCount)continue;e.prepareForRendering(d);const n=e.fillVAO;if(null!=n){if(d.bindVAO(n),E.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),d.setStencilFunction(514,s.stencilRef,255),c){const e=Math.max(2**(Math.round(p)-s.key.level),1),t=s.rangeX/(x*s.width*e);E.setUniform1f("u_patternFactor",t)}if(f){const t=e.patternMap;if(!t)continue;for(const[e,a]of t){const t=_.getPageSize(e);null!=t&&(_.bind(d,9729,e,i.$U),E.setUniform2fv("u_mosaicSize",t),E.setUniform1i("u_texture",i.$U),d.drawElements(r.WR.TRIANGLES,a[1],r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else d.drawElements(r.WR.TRIANGLES,e.fillIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.fillIndexStart);s.triangleCount+=e.fillIndexCount/3}}}_drawOutline(e,t,a,i,n,o){const{context:l,displayLevel:c,state:u,painter:f,pixelRatio:d,spriteMosaic:p,requestRender:g,allowDelayedRender:m}=e,y=a.outlineMaterial,_=f.vectorTilesMaterialManager,M=.75/d,h=this._outlineProgramOptions,v=_.getMaterialProgram(l,y,h);if(m&&null!=g&&!v.compiled)return void g();l.useProgram(v),v.setUniformMatrix3fv("u_displayMat3",1===o?u.displayMat3:u.displayViewMat3),v.setUniform2fv("u_fillTranslation",n),v.setUniform1f("u_depth",a.z+s),v.setUniform1f("u_outline_width",M);let U=-1;for(const s of i){if(!s.layerData.has(t))continue;s.key.level!==U&&(U=s.key.level,y.setDataUniforms(v,c,a,U,p));const e=s.layerData.get(t);if(e.prepareForRendering(l),!e.outlineIndexCount)continue;const i=e.outlineVAO;null!=i&&(l.bindVAO(i),v.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),l.setStencilFunction(514,s.stencilRef,255),l.drawElements(r.WR.TRIANGLES,e.outlineIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.outlineIndexStart),s.triangleCount+=e.outlineIndexCount/3)}}}},56012(e,t,a){a.d(t,{$:()=>s});var i=a(5095),n=a(3986),r=a(93345);class s extends n.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:a,displayLevel:n,state:s,painter:o,pixelRatio:l,spriteMosaic:c,styleLayerUID:u,requestRender:f,allowDelayedRender:d}=e;if(!t.some(e=>{var t,a;return null!==(t=null===(a=e.layerData.get(u))||void 0===a?void 0:a.lineIndexCount)&&void 0!==t&&t}))return;const p=e.styleLayer,g=p.lineMaterial,m=o.vectorTilesMaterialManager,y=p.getPaintValue("line-translate",n),_=p.getPaintValue("line-translate-anchor",n),M=p.getPaintProperty("line-pattern"),h=void 0!==M,v=h&&M.isDataDriven;let U,x;if(h&&!v){const e=M.getValue(n);U=c.getMosaicItemPosition(e)}let P=!1;if(!h){const e=p.getPaintProperty("line-dasharray");if(x=void 0!==e,P=x&&e.isDataDriven,x&&!P){const t=e.getValue(n),a=p.getDashKey(t,p.getLayoutValue("line-cap",n));U=c.getMosaicItemPosition(a)}}const E=1/l,S=this._programOptions;S.pattern=h,S.sdf=x;const w=m.getMaterialProgram(a,g,S);if(d&&null!=f&&!w.compiled)return void f();if(a.useProgram(w),w.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),w.setUniformMatrix3fv("u_displayMat3",1===_?s.displayMat3:s.displayViewMat3),w.setUniform2fv("u_lineTranslation",y),w.setUniform1f("u_depth",p.z),w.setUniform1f("u_antialiasing",E),U&&null!=U){const{page:e}=U,t=c.getPageSize(e);null!=t&&(c.bind(a,9729,e,i.$U),w.setUniform2fv("u_mosaicSize",t),w.setUniform1i("u_texture",i.$U))}let D=-1;for(const R of t){if(!R.layerData.has(u))continue;R.key.level!==D&&(D=R.key.level,g.setDataUniforms(w,n,p,D,c));const e=2**(n-D)/l;w.setUniform1f("u_zoomFactor",e);const t=R.layerData.get(u);if(!t.lineIndexCount)continue;t.prepareForRendering(a);const s=t.vao;if(null!=s){if(a.bindVAO(s),w.setUniformMatrix3fv("u_dvsMat3",R.transforms.displayViewScreenMat3),a.setStencilFunction(514,R.stencilRef,255),v||P){const e=t.patternMap;if(!e)continue;for(const[t,n]of e){const e=c.getPageSize(t);null!=e&&(c.bind(a,9729,t,i.$U),w.setUniform2fv("u_mosaicSize",e),w.setUniform1i("u_texture",i.$U),a.drawElements(r.WR.TRIANGLES,n[1],r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else a.drawElements(r.WR.TRIANGLES,t.lineIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart);R.triangleCount+=t.lineIndexCount/3}}}}},78403(e,t,a){a.d(t,{Z:()=>i});class i{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(t.has(e))return t.get(e);const a=this._read(e);if(!a)throw new Error("cannot find shader file ".concat(e));const i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let n=i.exec(a);const r=[];for(;null!=n;)r.push({path:n[1],start:n.index,length:n[0].length}),n=i.exec(a);let s=0,o="";return r.forEach(e=>{o+=a.slice(s,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),s=e.start+e.length}),o+=a.slice(s),t.set(e,o),o}_read(e){return this._readFile(e)}}}}]);
//# sourceMappingURL=66167.8d862abd.chunk.js.map